# Magic8â€‘Companion\n\n*Intelligent orchestration layer for 0â€‘DTE combo type selection & position risk management*\n\n> **Status**: Implementation Ready (v1.1, June 7 2025)\n\n![Python](https://img.shields.io/badge/Python-3.11-blue)\n![License](https://img.shields.io/badge/license-MIT-green)\n\n---\n\n## âœ¨ What is Magic8â€‘Companion?\n\nMagic8â€‘Companion is a **companion system** that works alongside the existing **Magic8** prediction system to provide:\n\nğŸ¯ **Smart Combo Type Selection** â€” Analyzes Magic8's 5â€‘minute predictions and recommends which 0â€‘DTE option combo type (Iron Condor, Butterfly, or Vertical) is most favorable at scheduled checkpoints\n\nğŸš¨ **Intelligent Risk Management** â€” Monitors open positions and generates exit signals when market conditions turn adverse\n\n**Key Design Principles:**\n* **Companion, not Clone** â€” Works WITH Magic8, doesn't replace it\n* **Wrapperâ€‘first** â€” Minimal custom logic, maximum use of proven systems\n* **Focused scope** â€” Does combo type selection and risk management only\n* **Shipâ€‘fast** â€” Deploy in â‰¤ 7 days as single Docker service\n\n---\n\n## ğŸ”„ How It Works\n\n```mermaid\nflowchart LR\n    A[Magic8<br/>5-min Predictions] --> B[Magic8â€‘Companion]\n    C[IB Portfolio<br/>Position Data] --> B\n    B --> D[Combo Type<br/>Recommendation]\n    B --> E[Exit Signal<br/>Generation]\n    D --> F[Discord Alerts]\n    E --> F\n```\n\n**At Scheduled Checkpoints** (10:30, 11:00, 12:30, 14:45 ET):\n1. **Consume** latest Magic8 prediction (trend, range, example trades)\n2. **Score** which combo type is most favorable based on market conditions\n3. **Recommend** highest-scoring combo type via Discord alerts\n\n**Continuously Monitor** open positions:\n1. **Track** positions via IB Portfolio API\n2. **Check** exit triggers (position drift, range shifts, trend reversals)\n3. **Alert** immediately when exit conditions are met\n\n---\n\n## ğŸš€ Features\n\n### Combo Type Intelligence\n* **Butterfly Favorability** â€” Detects when price is pinned near center with tight ranges\n* **Iron Condor Timing** â€” Identifies range-bound, neutral market conditions  \n* **Vertical Opportunities** â€” Recognizes strong directional trends with wide ranges\n* **Confidence Scoring** â€” Only recommends when score â‰¥ 70 and clearly best option\n\n### Risk Management\n* **Position Drift Detection** â€” Alerts when spot moves >75% of profit zone\n* **Range Shift Monitoring** â€” Exits when Magic8's predicted range no longer favorable\n* **Trend Reversal Alerts** â€” Closes directional trades on trend changes\n* **Loss Limit Enforcement** â€” Circuit breaker at $2k per position, $5k daily\n\n### Integration & Alerts\n* **Magic8 Data Parsing** â€” Flexible integration (file, HTTP, WebSocket)\n* **IB Portfolio Sync** â€” Real-time position tracking and P&L monitoring\n* **Discord Notifications** â€” Instant alerts with clear action recommendations\n* **Scheduled Execution** â€” Precise checkpoint timing with timezone handling\n\n---\n\n## ğŸ—ï¸ Architecture\n\n| Component | Technology | Purpose |\n|-----------|------------|----------|\n| **Magic8 Integration** | File I/O / HTTP / WebSocket | Consume Magic8 predictions |\n| **Position Tracking** | `ib_async` | IB portfolio synchronization |\n| **Combo Scoring** | Custom Python logic | Type favorability algorithms |\n| **Risk Monitoring** | Custom Python logic | Exit signal generation |\n| **Scheduling** | `APScheduler` | Checkpoint execution |\n| **Alerts** | Discord webhooks | Instant notifications |\n| **Data Storage** | SQLite | Position tracking database |\n| **Configuration** | `pydantic-settings` | Environment-based config |\n\n---\n\n## âš™ï¸ Prerequisites\n\n* **Magic8 System** â€” Running and producing 5-minute predictions\n* **Interactive Brokers** â€” TWS or IB Gateway (paper trading recommended)\n* **Discord Webhook** â€” For receiving alerts\n* **Docker & Docker Compose** â€” For containerized deployment\n* **Python â‰¥ 3.11** â€” If running outside Docker\n\n---\n\n## ğŸ”§ Quick Start\n\n### 1. Clone & Configure\n```bash\ngit clone https://github.com/birddograbbit/Magic8-Companion.git\ncd Magic8-Companion\n\n# Setup environment\ncp .env.example .env\nnano .env  # Configure paths and credentials\n```\n\n### 2. Environment Configuration\n```env\n# Magic8 Integration\nMAGIC8_SOURCE=file  # file, http, or websocket\nMAGIC8_FILE_PATH=/path/to/magic8/output.json\nMAGIC8_POLL_INTERVAL=30\n\n# Interactive Brokers\nIB_HOST=127.0.0.1\nIB_PORT=7497\nIB_CLIENT_ID=2\n\n# Alerts\nDISCORD_WEBHOOK=https://discord.com/api/webhooks/your-webhook-url\n\n# Risk Limits\nMAX_DAILY_LOSS=5000\nMAX_POSITION_LOSS=2000\n\n# Timezone\nTZ=America/New_York\n```\n\n### 3. Deploy\n```bash\n# Start the system\ndocker-compose up -d\n\n# Monitor activity\ndocker-compose logs -f magic8_companion\n```\n\n### 4. Verify Operation\nCheck Discord for checkpoint alerts like:\n```\nğŸ¯ Magic8-Companion Checkpoint 10:30 ET\nSPX: $5,848.66\nRecommendation: IRON CONDOR (Score: 78)\nMagic8 Range: 5850-5860, Strength: 0.53\nRationale: Range-bound market, neutral trend strength\n```\n\n---\n\n## ğŸ“… Scheduled Operation\n\n**Daily Checkpoints** (Eastern Time):\n* **10:30 AM** â€” Morning market assessment\n* **11:00 AM** â€” Post-opening stability check  \n* **12:30 PM** â€” Midday momentum evaluation\n* **02:45 PM** â€” Pre-close positioning\n\n**Continuous Monitoring**:\n* Position tracking every 60 seconds\n* Exit signal evaluation in real-time\n* Discord alerts within 30 seconds of trigger\n\n---\n\n## ğŸ“Š Sample Alerts\n\n### Combo Type Recommendation\n```\nğŸ¯ CHECKPOINT ALERT ğŸ¯\nTime: 10:30 ET | SPX: $5,848.66\n\nRECOMMENDATION: BUTTERFLY (Score: 85)\nConfidence: HIGH\n\nMarket Analysis:\nâ€¢ Range: 5850-5860 (tight)\nâ€¢ Trend Strength: 0.53 (neutral)\nâ€¢ Center Distance: 0.3% (pinning likely)\n\nMagic8 Data:\nâ€¢ Predicted Close: 5849.52\nâ€¢ Call Level: 5900\nâ€¢ Put Level: 5850\n```\n\n### Exit Signal\n```\nğŸš¨ EXIT SIGNAL ğŸš¨\nPosition: Iron Condor 5890/5910/5780/5770\n\nTRIGGER: Position Drift\nCurrent SPX: 5920 (approaching short call)\nUnrealized P&L: -$1,240\n\nACTION REQUIRED: Close position immediately\nReason: Spot within 2% of short call strike\n```\n\n---\n\n## ğŸ§ª Testing\n\n### Unit Tests\n```bash\n# Run test suite\npytest tests/ -v\n\n# Test specific module\npytest tests/test_combo_scorer.py -v\n```\n\n### Integration Testing\n```bash\n# Simulate Magic8 data\necho '{\"spot_price\": 5850, \"trend\": \"Up\", \"strength\": 0.75}' > data/magic8_test.json\n\n# Test checkpoint execution\npython -m magic8_companion.test_checkpoint\n```\n\n---\n\n## ğŸ›£ï¸ Development Roadmap\n\n### Phase 1: Core Implementation (Week 1)\n- [x] Magic8 data integration\n- [x] Combo type scoring logic\n- [x] Position tracking system\n- [x] Discord alerting\n- [x] Scheduled execution\n\n### Phase 2: Enhancements (Week 2-3)\n- [ ] WebSocket Magic8 integration\n- [ ] Advanced exit signal algorithms\n- [ ] Historical performance tracking\n- [ ] Strategy backtesting module\n\n### Phase 3: Platform Evolution (Month 2)\n- [ ] Web dashboard interface\n- [ ] Multiple broker support\n- [ ] ML-enhanced scoring models\n- [ ] Multi-timeframe analysis\n\n---\n\n## ğŸ¤ Contributing\n\nWe welcome contributions! Please:\n\n1. **Open an issue** for major changes\n2. **Follow the wrapper-first principle** â€” extend, don't modify core systems\n3. **Include tests** for new functionality\n4. **Update documentation** as needed\n\n---\n\n## ğŸ“„ License\n\nMIT Â© 2025 Magic8â€‘Companion contributors\n\n---\n\n## ğŸ†˜ Support\n\n* **Documentation**: See `/docs` folder for detailed implementation guides\n* **Issues**: GitHub Issues for bug reports and feature requests\n* **Discussions**: GitHub Discussions for questions and ideas\n\n*Built to enhance Magic8's capabilities with systematic combo type selection and disciplined risk management.*\n